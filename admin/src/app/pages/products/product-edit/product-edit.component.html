<form [formGroup]="editProductFormGroup" enctype="multipart/form-data" (ngSubmit)="onSubmit()">
    <nb-card>
        <nb-card-body style="padding: 50px;">
            <nb-stepper orientation="horizontal">
                <nb-step label="Basic Information" class="d-flex flex-column align-item-center" formGroupName="product">
                    <div class="row d-flex justify-content-center">
                        <div class="col-12 d-flex justify-content-center">
                            <h4>Basic Information #1</h4>
                        </div>
                        <div class="col-lg-6 col-md-12 mt-5">
                            <div class="row px-0">
                                <div class="col-12">
                                    <input type="text" nbInput fullWidth placeholder="Product Name"
                                        formControlName="name" maxlength="200">
                                    <div class="alert alert-danger mt-1"
                                        *ngIf="product.get('name').invalid && (product.get('name').dirty || product.get('name').touched)">
                                        <div *ngIf="product.get('name').errors['notblank']">
                                            Product Name is required
                                        </div>

                                        <div *ngIf="product.get('name').errors['maxlength']">
                                            Product Name must not exceed 200 characters
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-12 mt-3">
                                    <nb-select fullWidth placeholder="Catalog" formControlName="catalog">
                                        <nb-select-label>
                                            Catalog: {{ product.get('catalog').value !== null ? product.get('catalog').value['catalogName'] : null}}
                                        </nb-select-label>
                                        <nb-option *ngFor="let cata of catalogs" [value]="cata">
                                            <div class="row no-gutter px-0">
                                                <div class="col-5">
                                                    <img [src]="cata.image.imageUrl" class="d-block w-100">
                                                </div>
                                                <div class="col-7 d-flex justify-content-between align-items-center">
                                                    <p><b>{{cata.catalogName}}</b></p>
                                                </div>
                                            </div>
                                        </nb-option>
                                    </nb-select>
                                </div>
                                <div class="col-lg-6 col-md-12 mt-3">
                                    <nb-select fullWidth placeholder="Product Sale" formControlName="productSale"
                                        (selectedChange)="selectProductSale()">
                                        <nb-select-label>
                                            Sale: {{ product.get('productSale').value !== null ?
                                            product.get('productSale').value['saleName'] : null}}
                                        </nb-select-label>
                                        <nb-option *ngFor="let sale of sales" [value]="sale">
                                            <div class="sale-item">
                                                <div class="sale-info">
                                                    <p>
                                                        <b>
                                                            {{ sale.saleName | uppercase }} -
                                                            {{(sale.productSaleType.typeName === 'Fixed') ? ('$' +
                                                            sale.discount) : (sale.discount + '%') }}
                                                        </b>
                                                    </p>
                                                    <p>{{ sale.startedAt | date }} - {{ sale.expiredAt | date }}</p>
                                                    <p>Desc: {{ sale.description }}</p>
                                                </div>
                                            </div>
                                        </nb-option>
                                    </nb-select>
                                </div>
                                <div class="col-lg-6 col-md-12 mt-3">
                                    <nb-select fullWidth placeholder="Difficulty In Growing" formControlName="level">
                                        <nb-select-label>
                                            Difficulty: {{ product.get('level').value !== null ? product.get('level').value['level'] : null}}
                                        </nb-select-label>
                                        <nb-option *ngFor="let level of levels" [value]="level">{{level.level}}</nb-option>
                                    </nb-select>
                                </div>
                                <div class="col-6 mt-3">
                                    <div class="row">
                                        <div class="col-6">
                                            <nb-checkbox (checkedChange)="product.get('new_').setValue($event)"
                                                [checked]="product.get('new_').value" status="success">
                                                New
                                            </nb-checkbox>
                                        </div>
                                        <div class="col-6">
                                            <nb-checkbox (checkedChange)="product.get('active').setValue($event)"
                                                [checked]="product.get('active').value" status="warning">
                                                Active
                                            </nb-checkbox>
                                        </div>
                                        <div class="col-6 mt-2">
                                            <nb-checkbox (checkedChange)="product.get('top').setValue($event)"
                                                [checked]="product.get('top').value" status="danger">
                                                Top
                                            </nb-checkbox>
                                        </div>
                                        <div class="col-6 mt-2">
                                            <nb-checkbox (checkedChange)="product.get('sale').setValue($event)"
                                                [checked]="product.get('sale').value" status="info"
                                                (click)="$event.preventDefault()">
                                                Sale
                                            </nb-checkbox>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 mt-3">
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Upload</span>
                                        </div>
                                        <div class="custom-file">
                                            <input type="file" mutliple class="custom-file-input" multiple
                                                accept="image/png, image/jpeg" (change)="selectFiles($event)">
                                            <label class="custom-file-label">Choose images</label>
                                        </div>
                                    </div>
                                    <div class="alert alert-danger mt-1"
                                        *ngIf="product.get('images').invalid && (product.get('images').dirty || product.get('images').touched)">
                                        <div *ngIf="product.get('images').errors['required']">
                                            Must upload at least 1 image
                                        </div>
                                    </div>
                                </div>
                                <div class="row d-flex justify-content-center">
                                    <div class="col-8 d-flex justify-content-center">
                                        <ngx-images-carousel></ngx-images-carousel>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-12 mt-4">
                            <div class="row">
                                <div class="col-12">
                                    <ckeditor class="ckeditor" [editor]="Editor" [config]="editorConfig"
                                        formControlName="description" maxlength="1000"></ckeditor>
                                    <div class="alert alert-danger mt-1"
                                        *ngIf="product.get('description').invalid && (product.get('description').dirty || product.get('description').touched)">
                                        <div *ngIf="product.get('description').errors['notblank']">
                                            Product description is required
                                        </div>

                                        <div *ngIf="product.get('description').errors['maxlength']">
                                            Product description must not exceed 1000 characters
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12  d-flex justify-content-center mt-3">
                            <button nbButton disabled nbStepperNext>prev</button>
                            <button nbButton nbStepperNext  class="ml-3">next</button>
                        </div>
                    </div>
                </nb-step>
                <nb-step label="Variants" formArrayName="variants">
                    <div class="row d-flex justify-content-center">
                        <div class="col-12 d-flex justify-content-center">
                            <h4>Variants Information #2</h4>
                        </div>
                        <div class="col-lg-6 mt-5">
                            <nb-accordion multi>
                                <nb-accordion-item *ngFor="let variantForm of variants.controls; let i = index">
                                    <nb-accordion-item-header class="d-flex justify-content-between align-items-center">
                                        <p class="font-weight-bold">Variant #{{i + 1}}</p>
                                        <ng-container *ngIf="i !== 0">
                                            <button nbButton [size]="'small'" [status]="'danger'" class="mr-5"
                                                (click)="removeVariant(i, $event)">
                                                <nb-icon icon="trash-outline"></nb-icon>
                                            </button>
                                        </ng-container>
                                        <ng-container *ngIf="i === 0">
                                            <button nbButton [size]="'small'" [status]="'danger'" class="mr-5"
                                                (click)="removeVariant(i, $event)" style="visibility: hidden">
                                                <nb-icon icon="trash-outline"></nb-icon>
                                            </button>
                                        </ng-container>
                                    </nb-accordion-item-header>
                                    <nb-accordion-item-body [formGroup]="variantForm">
                                        <div class="row">
                                            <div class="col-lg-6 col-md-12 my-2">
                                                <input type="number" nbInput fullWidth placeholder="Height (cm)"
                                                    formControlName="height">
                                                <div class="alert alert-danger mt-1"
                                                    *ngIf="variantForm.get('height').invalid && (variantForm.get('height').dirty || variantForm.get('height').touched)">
                                                    <div *ngIf="variantForm.get('height').errors['required']">
                                                        Height is required
                                                    </div>
                                                    <div *ngIf="variantForm.get('height').errors['min']">
                                                        Min value is 1
                                                    </div>
                                                    <div *ngIf="variantForm.get('height').errors['max']">
                                                        Max value is 10000
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6 col-md-12 my-2">
                                                <input type="number" nbInput fullWidth placeholder="Width (cm)"
                                                    formControlName="width">
                                                <div class="alert alert-danger mt-1"
                                                    *ngIf="variantForm.get('width').invalid && (variantForm.get('width').dirty || variantForm.get('width').touched)">
                                                    <div *ngIf="variantForm.get('width').errors['required']">
                                                        Width is required
                                                    </div>
                                                    <div *ngIf="variantForm.get('width').errors['min']">
                                                        Min value is 1
                                                    </div>
                                                    <div *ngIf="variantForm.get('width').errors['max']">
                                                        Max value is 10000
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-lg-6 col-md-12 my-2">
                                                <input type="number" nbInput fullWidth placeholder="Price ($)"
                                                    formControlName="price">
                                                <div class="alert alert-danger mt-1"
                                                    *ngIf="variantForm.get('price').invalid && (variantForm.get('price').dirty || variantForm.get('price').touched)">
                                                    <div *ngIf="variantForm.get('price').errors['required']">
                                                        Price is required
                                                    </div>
                                                    <div *ngIf="variantForm.get('price').errors['min']">
                                                        Min value is 1
                                                    </div>
                                                    <div *ngIf="variantForm.get('price').errors['max']">
                                                        Max value is 10000
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6 col-md-12 my-2">
                                                <input type="number" nbInput fullWidth placeholder="Quantity"
                                                    formControlName="quantity">
                                                <div class="alert alert-danger mt-1"
                                                    *ngIf="variantForm.get('quantity').invalid && (variantForm.get('quantity').dirty || variantForm.get('quantity').touched)">
                                                    <div *ngIf="variantForm.get('quantity').errors['required']">
                                                        Quantity is required
                                                    </div>
                                                    <div *ngIf="variantForm.get('quantity').errors['min']">
                                                        Min value is 1
                                                    </div>
                                                    <div *ngIf="variantForm.get('quantity').errors['max']">
                                                        Max value is 10000
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-lg-12 my-2">
                                                <nb-select fullWidth placeholder="Size" formControlName="size">
                                                    <nb-select-label>
                                                        Size: {{ variantForm.get('size').value !== null ? variantForm.get('size').value['sizeName'] : null}}
                                                    </nb-select-label>
                                                    <nb-option *ngFor="let size of sizes"
                                                        [value]="size">{{size.sizeName}}</nb-option>
                                                </nb-select>
                                                <div class="alert alert-danger mt-1"
                                                    *ngIf="variantForm.get('size').invalid && (variantForm.get('size').dirty || variantForm.get('size').touched)">
                                                    <div *ngIf="variantForm.get('size').errors['required']">
                                                        Size is required
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-lg-4">
                                                <div class="input-group mb-3">
                                                    <div class="custom-file">
                                                        <input type="file" class="custom-file-input"
                                                            accept="image/png, image/jpeg"
                                                            (change)="selectFile($event, i)">
                                                        <label class="custom-file-label">Choose image</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <ng-container *ngIf="variantForm.get('image').value !== null">
                                                <div class="col-lg-8">
                                                    <img [src]="variantForm.get('image').value" class="d-block w-100"
                                                        alt="Slide Image">
                                                </div>
                                            </ng-container>
                                        </div>
                                    </nb-accordion-item-body>
                                </nb-accordion-item>
                            </nb-accordion>
                            <button nbButton [status]="'success'" (click)="addVariant($event)" class="mt-3">
                                <nb-icon icon="plus-outline"></nb-icon>
                            </button>
                        </div>
                        <div class="col-lg-6 col-md-12 mt-5">
                            <div class="input-group mb-3">
                                <div class="custom-file">
                                    <input type="file" class="custom-file-input" accept="image/png, image/jpeg"
                                        (change)="selectFileSizeGuide($event)">
                                    <label class="custom-file-label">Choose image</label>
                                </div>
                            </div>
                            <ng-container *ngIf="product.get('imgSizeGuide').value !== null">
                                <img [src]="product.get('imgSizeGuide').value" class="d-block w-100" alt="Slide Image">
                            </ng-container>
                        </div>
                        <div class="col-12 d-flex justify-content-center mt-3">
                            <button nbButton nbStepperPrevious>prev</button>
                            <button nbButton nbStepperNext  class="ml-3">next</button>
                        </div>
                    </div>
                </nb-step>
                <nb-step label="Care Guide" formGroupName="careGuide">
                    <div class="col-12 d-flex justify-content-center">
                        <h4>Care Guide #3</h4>
                    </div>
                    <div class="row mt-3">
                        <div class="col-lg-6 col-md-12">
                            <label for="watering" class="ml-1">Watering</label>
                            <textarea rows="5" nbInput fullWidth placeholder="Watering" id="watering"
                                formControlName="watering" style="resize: none"></textarea>
                            <div class="alert alert-danger mt-1" *ngIf="careGuide.get('watering').invalid && (careGuide.get('watering').dirty || careGuide.get('watering').touched)">
                                <div *ngIf="careGuide.get('watering').errors['maxlength']">
                                    Watering guide must not exceed 500 characters
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-12">
                            <label for="light" class="ml-1">Light</label>
                            <textarea rows="5" nbInput fullWidth placeholder="Light" id="light"
                                formControlName="light" style="resize: none"></textarea>
                            <div class="alert alert-danger mt-1" *ngIf="careGuide.get('light').invalid && (careGuide.get('light').dirty || careGuide.get('light').touched)">
                                <div *ngIf="careGuide.get('light').errors['maxlength']">
                                    Light guide must not exceed 500 characters
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-12 mt-3">
                            <label for="nutrition" class="ml-1">Nutrition</label>
                            <textarea rows="5" nbInput fullWidth placeholder="Nutrition" id="nutrition"
                                formControlName="nutrition" style="resize: none"></textarea>
                            <div class="alert alert-danger mt-1" *ngIf="careGuide.get('nutrition').invalid && (careGuide.get('nutrition').dirty || careGuide.get('nutrition').touched)">
                                <div *ngIf="careGuide.get('nutrition').errors['maxlength']">
                                    Nutrition guide must not exceed 500 characters
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-12 mt-3">
                            <label for="cleaning" class="ml-1">Cleaning</label>
                            <textarea rows="5" nbInput fullWidth placeholder="Cleaning" id="cleaning"
                                formControlName="cleaning" style="resize: none"></textarea>
                            <div class="alert alert-danger mt-1" *ngIf="careGuide.get('cleaning').invalid && (careGuide.get('cleaning').dirty || careGuide.get('cleaning').touched)">
                                <div *ngIf="careGuide.get('cleaning').errors['maxlength']">
                                    Cleaning guide must not exceed 500 characters
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-12 mt-3">
                            <label for="pruning" class="ml-1">Pruning</label>
                            <textarea rows="5" nbInput fullWidth placeholder="Pruning" id="pruning"
                                formControlName="pruning" style="resize: none"></textarea>
                            <div class="alert alert-danger mt-1" *ngIf="careGuide.get('pruning').invalid && (careGuide.get('pruning').dirty || careGuide.get('pruning').touched)">
                                <div *ngIf="careGuide.get('pruning').errors['maxlength']">
                                    Pruning guide must not exceed 500 characters
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-12 mt-3">
                            <label for="bugs" class="ml-1">Bugs</label>
                            <textarea rows="5" nbInput fullWidth placeholder="Bugs" id="bugs"
                                formControlName="bugs" style="resize: none"></textarea>
                            <div class="alert alert-danger mt-1" *ngIf="careGuide.get('bugs').invalid && (careGuide.get('bugs').dirty || careGuide.get('bugs').touched)">
                                <div *ngIf="careGuide.get('bugs').errors['maxlength']">
                                    Bugs guide must not exceed 500 characters
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-12 mt-3">
                            <label for="trouble" class="ml-1">Trouble</label>
                            <textarea rows="5" nbInput fullWidth placeholder="Trouble" id="trouble"
                                formControlName="trouble" style="resize: none"></textarea>
                            <div class="alert alert-danger mt-1" *ngIf="careGuide.get('trouble').invalid && (careGuide.get('trouble').dirty || careGuide.get('trouble').touched)">
                                <div *ngIf="careGuide.get('trouble').errors['maxlength']">
                                    Trouble guide must not exceed 500 characters
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-12 mt-3">
                            <label for="warning" class="ml-1">Warning</label>
                            <textarea rows="5" nbInput fullWidth placeholder="Warning" id="warning"
                                formControlName="warning" style="resize: none"></textarea>
                            <div class="alert alert-danger mt-1" *ngIf="careGuide.get('warning').invalid && (careGuide.get('warning').dirty || careGuide.get('warning').touched)">
                                <div *ngIf="careGuide.get('warning').errors['maxlength']">
                                    Warning guide must not exceed 500 characters
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 d-flex justify-content-center mt-3">
                        <button nbButton nbStepperPrevious>prev</button>
                        <button nbButton status="success" type="submit" class="ml-3">PUBLISH</button>
                    </div>
                </nb-step>
            </nb-stepper>
        </nb-card-body>
    </nb-card>
</form>